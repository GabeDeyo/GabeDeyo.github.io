<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Design Patterns - Service Locator</title>

    <meta name="viewport" content="width=device-width,initial-scale=1.0, shrink-to-fit=no" />

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/page.css">
</head>

<body>

    <!-- Top Navigation -->
    <header>
        <nav class="navbar navbar-inverse">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#collapsemenu" aria-expanded="false">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a href="../index.html" class="navbar-brand">Personal Notes</a>
                </div>

                <div class="collapse navbar-collapse" id="collapsemenu">
                    <ul class="nav navbar-nav">

                        <!-- GAME DEVELOMENT -->
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Game Development <span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <!-- CONCEPTS -->
                                <li><a href="concepts.html">Concepts <span class="glyphicon-chevron-right"></span></a></li>

                                <!-- ENGINE -->
                                <li><a href="engine.html">Engine <span class="glyphicon-chevron-right"></span></a></li>

                                <!-- IMPLEMENTATIONS -->
                                <li><a href="implementations.html">Implementations <span class="glyphicon-chevron-right"></span></a></li>
                            </ul>
                        </li>

                        <!-- PROGRAMMING -->
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Programming <span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <!-- ALGORITHMS -->
                                <li><a href="../code/algorithms.html">Algorithms <span class="glyphicon-chevron-right"></span></a></li>

                                <!-- PROBLEMS -->
                                <li><a href="../code/problems.html">Problems <span class="glyphicon-chevron-right"></span></a></li>

                                <!-- RANDOM -->
                                <li><a href="../code/random.html">Random <span class="glyphicon-chevron-right"></span></a></li>
                            </ul>
                        </li>

                        <!-- GABE DEVELOPMENT -->
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Gabe Development <span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <!-- FITNESS PAGE -->
                                <li><a href="../gabe/fitness.html">Fitness <span class="glyphicon-chevron-right"></span></a></li>

                                <!-- STYLE & GROOMING PAGE -->
                                <li><a href="../gabe/style.html">Style <span class="glyphicon-chevron-right"></span></a></li>

                                <!-- FINANCE PAGE -->
                                <li><a href="../gabe/finance.html">Finance <span class="glyphicon-chevron-right"></span></a></li>

                                <!-- PHILOSOPHY PAGE -->
                                <li><a href="../gabe/philosophy.html">Philosophy <span class="glyphicon-chevron-right"></span></a></li>
                            </ul>
                        </li>

                    </ul>
                </div>

            </div>
        </nav>
    </header>

    <!-------------------------------------------------------------------------->

    <!-- MAIN -->
    <main>
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <h1 id="title">Design Patterns - Service Locator</h1>

                    <aside>
                        <button type="button" class="btn btn-default" name="button" id="selectAll">Select All</button>
                        <button type="button" class="btn btn-default" name="button" id="clearAll">Clear All</button>
                    </aside>

                    <div class="jumbotron heliList">
                        <h2>Index</h2>
                        <ul>
                            <li><p><span class="glyphicon-remove"></span>
                                <a href="#intent">Intent</a>
                                </p>
                            </li>
                            <li><p><span class="glyphicon-remove"></span>
                                <a href="#motivation">Motivation</a>
                                </p>
                            </li>
                            <li><p><span class="glyphicon-remove"></span>
                                <a href="#service-locator">Service Locator</a>
                                </p>
                            </li>
                            <li><p><span class="glyphicon-remove"></span>
                                <a href="#when-to-use">When to Use It</a>
                                </p>
                            </li>
                            <li><p><span class="glyphicon-remove"></span>
                                <a href="#keep-in-mind">Keep in Mind</a>
                                </p>
                            </li>
                            <li><p><span class="glyphicon-remove"></span>
                                <a href="#sample-code">Sample Code</a>
                                </p>
                            </li>
                        </ul>
                    </div>

<div class="jumbotron col-md-12 heliList" id="intent">
    <h2>Intent</h2>
    <ul>
        <li><p><span class="glyphicon-remove"></span>
            <i>Provide a global point of access to a service without coupling users to the concrete class that implements it.</i>
        </p></li>
    </ul>
    <a href="#title"><span class="glyphicon-menu-up"></span></a>
</div>

<div class="jumbotron col-md-12 heliList" id="motivation">
    <h2>Motivation</h2>
    <ul>
        <li><p><span class="glyphicon-remove"></span>
            Some objects or systems in a game tend to get around, visiting almost every corner of the codebase. It's hard to find a part of the game that <i>won't</i> need a memory allocator, logging, or random numbers at some point. Systems like those can be thought of as <i>services</i> that need to be available to the entire game.
            <p><span class="glyphicon-remove"></span>For our example, we'll consider audio. It doesn't have quite the reach of something lower-level like a memory allocator, but it still touches a bunch of game systems. A falling rock hits the ground with a crash (Physics). A sniper NPC fires his rifle and a shot rings out (AI). The user selects a menu item with a beep of confirmation (User Interface).</p>
        </p></li>
        <li><p><span class="glyphicon-remove"></span>
            Each of these places will need to be able to call into the audio system with something like one of these:
            <pre>
            <span class="glyphicon-remove"></span>//Use a static class?
            AudioSystem::playSound(VERY_LOUND_BANG);

            //Or maybe a singleton?
            AudioSystem::instance()->playSound(VERY_LOUD_BANG);
            </pre>
        </p></li>
        <li><p><span class="glyphicon-remove"></span>
            Either gets us where we're trying to go, but we stumbled into some sticky coupling along the way. Every place in the game calling into our audio system directly references the concrete AudioSystem class and the mechanism for accessing it - either as a static class or a singleton.
            <p><span class="glyphicon-remove"></span>These call sites, of course have to be coupled to <i>something</i> in order to make a sound play, but letting them poke at the concrete audio implementaiton directly is like giving a hundred strangers directions to your house just so they can drop a ltter on your doorstep. Not only is it a little bit <i>too</i> personal, it's a real pain when you move and you have to tell each person the new directions.</p>
        </p></li>
        <li><p><span class="glyphicon-remove"></span>
            There's a better solution: a phone book. People that need to get in touch with us can look us up by name and get our current address. When we move, we tell the phone company. They update the book, and everyone gets the new address. In fact, we dont' even need to give out our real address at all. We can list a P.O. box or some other "representation" of ourselves instead. By having callers go through the book to find us, we have a <i>convenient single place where we control how we're found.</i>
            <p><span class="glyphicon-remove"></span>This is the Service Locator pattern in a nutshell - it decouples code that needs a service from both <i>who</i> it is (the concrete implementation type) and <i>where</i> it is (how we get to the instance of it).</p>
        </p></li>
    </ul>
    <a href="#title"><span class="glyphicon-menu-up"></span></a>
</div>

<div class="jumbotron col-md-12 heliList" id="service-locator">
    <h2>Service Locator</h2>
    <ul>
        <li><p><span class="glyphicon-remove"></span>
            A <b>service</b> class defines an abstract interface to a set of operations. A concrete <b>service provider</b> implements this interface. A separate <b>service locator</b> provides access to the service by finding an appropriate provider while hiding both the provider's concrete type and the process used to locate it.
        </p></li>
    </ul>
    <a href="#title"><span class="glyphicon-menu-up"></span></a>
</div>

<div class="jumbotron col-md-12 heliList" id="when-to-use">
    <h2>When to Use It</h2>
    <ul>
        <li><p><span class="glyphicon-remove"></span>
            Anytime you make something accessible to every part of your program, you're asking for trouble. That's the main problem with the Singleton pattern, and this pattern is no different. My most simple advice for using a service locator is: <i>sparingly</i>.
        </p></li>
        <li><p><span class="glyphicon-remove"></span>
            Instead of using a global mechanism to give some code access to an object it needs, first consider <i>passing the object to it instead.</i> That's dead simple, and it makes the coupling completely obvious. That will cover most of your needs.
        </p></li>
        <li><p><span class="glyphicon-remove"></span>
            <i>But...</i> there are some times when manually passing around an object is gratuitous or actively makes code harder to read. Some systems, like logging or memory management, shouldn't be part of a module's public API. The parameters to your rendering code should have to do with <i>rendering</i>, not stuff like logging.
        </p></li>
        <li><p><span class="glyphicon-remove"></span>
            Likewise, other systems represent facilities that are fundamentally singular in nature. Your game probably only has one audio device or display system that it can talk to. It is an ambitent property of the environment, so plumbing it through ten layers of methods just so one deeply nested call can get to it is adding needless complexity to your code.
        </p></li>
        <li><p><span class="glyphicon-remove"></span>
            In those kinds of cases, this pattern can help. As we'll see, it functions as a more flexible, more configurable cousin of the Singleton pattern. When used well, it can make your codebase more flexible with little runtime cost.
        </p></li>
    </ul>
    <a href="#title"><span class="glyphicon-menu-up"></span></a>
</div>

<div class="jumbotron col-md-12 heliList" id="keep-in-mind">
    <h2>Keep in Mind</h2>
    <ul>
        <li><p><span class="glyphicon-remove"></span>
            The core difficulty with a service locator is that it takes a dependency - a bit of coupling between two pieces of code - and defers wiring it up until runtime. This gives you flexibility, but the price you pay is that it's harder to understand what your dependencies are by reading the code.
        </p></li>
        <li><p><span class="glyphicon-remove"></span>
            <h3>The service actually has to be located</h3>
            <p><span class="glyphicon-remove"></span>With a singleton or a static class, there's no chance for the instance we need to <i>not</i> be available. Calling code can take for granted that it's there. but since this pattern has to <i>locate</i> the service, we may need to handle cases where that fails. Fotunately, we'll cover a strategy later to address this and guarantee that we'll always get <i>some</i> service when you need it.</p>
        </p></li>
        <li><p><span class="glyphicon-remove"></span>
            <h3>The service doens't know who is locating it</h3>
            <p><span class="glyphicon-remove"></span>Since the lcator is globally accessible, any code in the game could be requesting a service and thn poking at it. This means that the service must be able to work correctly in any circumstance. For example, a class that expects to be used only during the simulation portion of the game loop and not during rendering may not work as a service - it would'nt be able to ensure that it's being used at the right time. So, if a class expects to be used only in a certain context, it's safest to avoid exposing it to the entire world with this pattern.</p>
        </p></li>
    </ul>
    <a href="#title"><span class="glyphicon-menu-up"></span></a>
</div>

<div class="jumbotron col-md-12 heliList" id="sample-code">
    <h2>Sample Code</h2>
    <ul>
        <li><p><span class="glyphicon-remove"></span>
            Getting back to our audio system problem, let's address it by exposing the system to the rest of the codebase through a service locator.
        </p></li>
        <li><p><span class="glyphicon-remove"></span>
            <h3>The Service</h3>
            <p><span class="glyphicon-remove"></span>We'll start off with the audio API. This is the interface that our service will be exposing:</p>
            <pre>
            <span class="glyphicon-remove"></span>class Audio {
                public virtual ~Audio() {}
                public virtual void playSound(int soundID) = 0;
                public virtual void stopSound(int soundID) = 0;
                public virtual void stopAllSounds() = 0;
            }
            </pre>
            <p><span class="glyphicon-remove"></span>A real audio engine would be more complex than this, of course, but this shows the basic idea. What's important is that it's an abstract interface class with no implementation bound to it.</p>
        </p></li>
        <li><p><span class="glyphicon-remove"></span>
            <h3>The Service Provider</h3>
            <p><span class="glyphicon-remove"></span>By itself, our audio interface isn't very useful. We need a concrete implementation. This book isn't about how to write audio code for a game console, so you'll have to imagine there's some actual code in the bodies of these functions, but you get the idea:</p>
            <pre>
            <span class="glyphicon-remove"></span>class ConsoleAudio : public Audio {
                public virutal void playSound(int soundID) {
                    //Play sound using console audio api...
                }

                public virtual void stopSound(int soundID) {
                    //Stop sound using console audio api...
                }

                public virutal void stopAllSounds() {
                    //Stop all sounds using console audio api...
                }
            }
            </pre>
            <p><span class="glyphicon-remove"></span>Now we have an interface and an implementation. The remaining piece is the service locator - the class that ties the two together.</p>
        </p></li>
        <li><p><span class="glyphicon-remove"></span>
            <h3>A Simple Locator</h3>
            <p><span class="glyphicon-remove"></span>The implementation here is about the simplest kind of service locator you can define:</p>
            <pre>
            <span class="glyphicon-remove"></span>class Locator {
                public static Audio* getAudio() { return service_; }

                public static void provide(Audio* service) {
                    service_ = service;
                }

                private static Audio* service_;
            }
            </pre>
            <p><span class="glyphicon-remove"></span>The tenchnique this uses is called <i>dependency injections</i> and awkward bit of jargon for a very simple idea. Say you have one class that depends on another. In our case, our Locator class needs an instance of the Audio service. Normally, the locator would be responsible for constructing that instance itself. Dependency injection instead says that outside code is responsible for <i>injecting</i> that dependency into the object that needs it.</p>
        </p></li>
        <li><p><span class="glyphicon-remove"></span>
            The static getAudio() function does the locating. We can call it from anywhere in the codebase, and it will give us back an instance of our Audio service to use:
            <pre>
            <span class="glyphicon-remove"></span>Audio *audio = Locator::getAudio();
            audio->playSound(VERY_LOUD_BANG);
            </pre>
        </p></li>
    </ul>
    <a href="#title"><span class="glyphicon-menu-up"></span></a>
</div>

                    <!-------------------------------------->
                </div>
            </div>
    </main>

    <!-------------------------------------------------------------------------->

    <!-- FOOTER -->
    <footer class="navbar navbar-inverse navbar-fixed-bottom">
        <nav>
            <div class="container">
                <div class="row">
                    <div class="col-md-6 col-sm-6 col-xs-12">
                        <ul>
                            <li>&copy; 2017 <a href="http://www.gabedeyo.com">Gabe Deyo</a></li>
                            <li>|</li>
                            <li><a href="mailto:gabedeyo@gmail.com?subject=Notes">gabedeyo@gmail.com</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>
    </footer>

    <!-- Latest Minified Slim JQuery -->
    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha256-/SIrNqv8h6QGKDuNoLGA4iret+kyesCkHGzVUUV0shc=" crossorigin="anonymous"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

    <script src="../js/selection.js" charset="utf-8"></script>
</body>

</html>

<!-- Section Template

<div class="jumbotron col-md-12 heliList" id="">
    <h2>XXX</h2>
    <ul>
        <li><p><span class="glyphicon-remove"></span>
            XXX
        </p></li>
        <li><p><span class="glyphicon-remove"></span>
            XXX
        </p></li>
        <li><p><span class="glyphicon-remove"></span>
            XXX
        </p></li>
    </ul>
    <a href="#title"><span class="glyphicon-menu-up"></span></a>
</div>

-->
